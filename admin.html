<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8">
  <title>Ù„ÙˆØ­Ø© ØªØ­ÙƒÙ… Ø§Ù„Ø¨Ø§Ø¦Ø¹ ğŸ› ï¸</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <style>
    body {
      font-family: 'Cairo', sans-serif;
      background-color: #f5f5f5;
      margin: 0;
      padding: 20px;
      color: #333;
    }

    /* ---------- top bar ---------- */
    .topbar {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      height: 64px;
      background: linear-gradient(90deg, #ffffffcc, #f0f8ffcc);
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 8px 20px;
      box-shadow: 0 2px 6px rgba(0,0,0,0.06);
      z-index: 999;
      backdrop-filter: blur(4px);
    }
    .topbar .title {
      font-weight: 700;
      color: #2e7d32;
      font-size: 1.1rem;
    }
    .topbar .profile-area {
      display: flex;
      align-items: center;
      gap: 10px;
    }
    .topbar img.top-profile-pic {
      width: 44px;
      height: 44px;
      border-radius: 50%;
      object-fit: cover;
      border: 2px solid #ddd;
      cursor: pointer;
      box-shadow: 0 2px 6px rgba(0,0,0,0.08);
    }
    .topbar .profile-name {
      font-size: 0.95rem;
      color: #444;
      display: none; /* Ø¥Ø°Ø§ Ø£Ø±Ø¯Øª Ø¥Ø¸Ù‡Ø§Ø± Ø§Ù„Ø§Ø³Ù… Ø¶Ø¹ display:block */
    }

    /* Ø£ÙŠÙ‚ÙˆÙ†Ø§Øª Ø§Ù„Ø´Ø±ÙŠØ· */
    .icon-btn {
      width: 40px;
      height: 40px;
      border-radius: 8px;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      background: #ffffff;
      border: 1px solid #e0e0e0;
      cursor: pointer;
      box-shadow: 0 2px 6px rgba(0,0,0,0.04);
      margin-left: 8px;
      font-size: 18px;
    }

    /* Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ù…Ù†Ø¨Ø«Ù‚Ø© */
    .settings-menu {
      position: absolute;
      top: 68px;
      right: 20px;
      background: white;
      border: 1px solid #e6e6e6;
      border-radius: 10px;
      box-shadow: 0 10px 30px rgba(0,0,0,0.08);
      padding: 8px;
      width: 220px;
      display: none;
      z-index: 1000;
    }
    .settings-menu.show { display: block; }
    .settings-item {
      padding: 10px 12px;
      border-radius: 8px;
      cursor: pointer;
      font-weight: 600;
      color: #333;
      display: flex;
      align-items: center;
      gap: 8px;
    }
    .settings-item:hover { background: #f6f9ff; }

    /*modal Ø§Ù„Ø·Ù„Ø¨Ø§Øª*/
    .orders-modal {
      display: none;
      position: fixed;
      z-index: 1500;
      left: 0;
      top: 0;
      width: 100%;
      height: 100%;
      background: rgba(0,0,0,0.45);
      align-items: center;
      justify-content: center;
      padding: 20px;
      box-sizing: border-box;
    }
    .orders-modal.show { display: flex; }
    .orders-panel {
      width: 100%;
      max-width: 1000px;
      max-height: 86vh;
      overflow: auto;
      background: #fff;
      border-radius: 12px;
      padding: 18px;
      box-shadow: 0 20px 50px rgba(0,0,0,0.2);
      text-align: right;
    }
    .orders-panel h2 { margin-top:0; color:#2e7d32; }
    .orders-list { display: grid; gap: 12px; }
    .order-card {
      border: 1px solid #eee;
      padding: 12px;
      border-radius: 10px;
      background: #fafafa;
    }
    .order-meta { font-size: 0.95rem; color:#444; display:flex; gap:12px; flex-wrap:wrap; align-items:center; }
    .order-items { margin-top:8px; border-top:1px dashed #eee; padding-top:8px; }
    .order-item { display:flex; justify-content:space-between; gap:12px; padding:6px 0; }
    .order-actions { margin-top:10px; display:flex; gap:8px; }
    .small-btn {
      border: none;
      padding: 8px 10px;
      border-radius: 8px;
      cursor: pointer;
      font-weight:600;
    }
    .btn-email { background:#1e88e5; color:#fff; }
    .btn-call { background:#43a047; color:#fff; }
    .btn-delete-order { background:#e53935;color:#fff; }
    .no-orders { text-align:center; padding:24px; color:#777; }

    /* Ù„Ø¥Ø²Ø§Ø­Ø© Ø§Ù„Ù…Ø­ØªÙˆÙ‰ Ù‚Ù„ÙŠÙ„Ø§Ù‹ ØªØ­Øª Ø§Ù„Ø´Ø±ÙŠØ· */
    .page-content { padding-top: 88px; }

    h1 {
      color: #4CAF50;
      text-align: center;
      margin-bottom: 20px;
    }

    /* ØµÙ Ø§Ù„Ø¹Ù†Ø§ÙˆÙŠÙ† Ø§Ù„Ø£ÙÙ‚ÙŠ */
    .titles-row {
      display: flex;
      justify-content: center;
      gap: 18px;
      margin-bottom: 18px;
      flex-wrap: wrap;
    }
    .titles-row .title-pill {
      background: #fff;
      padding: 10px 16px;
      border-radius: 999px;
      border: 1px solid #e0e0e0;
      box-shadow: 0 1px 3px rgba(0,0,0,0.05);
      cursor: pointer;
      font-weight: 600;
    }
    .titles-row .title-pill:hover {
      background: #f0fff0;
    }

    form {
      background: #fff;
      padding: 20px;
      border-radius: 12px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
      max-width: 500px;
      margin: 0 auto 30px;
    }

    form input, form textarea, form label {
      width: 100%;
      margin-bottom: 10px;
      padding: 10px;
      font-size: 1em;
      border: 1px solid #ccc;
      border-radius: 6px;
      box-sizing: border-box;
    }

    .file-row {
      display: flex;
      gap: 8px;
      align-items: center;
    }

    .img-preview {
      max-width: 100%;
      max-height: 140px;
      border-radius: 6px;
      display: block;
      margin-top: 6px;
      object-fit: cover;
    }

    button {
      padding: 12px 20px;
      background-color: #4CAF50;
      color: white;
      border: none;
      font-size: 1em;
      border-radius: 6px;
      cursor: pointer;
    }

    button:hover {
      background-color: #388e3c;
    }

    .product-list {
      max-width: 900px;
      margin: 0 auto;
    }

    .product-card {
      background: #fff;
      border: 1px solid #ddd;
      border-radius: 10px;
      padding: 15px;
      margin-bottom: 15px;
    }

    .product-card .card-actions {
      margin-top: 10px;
      display: flex;
      gap: 8px;
      justify-content: flex-start;
    }

    .btn-edit {
      background-color: #1976d2;
      color: white;
      border: none;
      padding: 8px 12px;
      border-radius: 6px;
      cursor: pointer;
    }
    .btn-edit:hover { background-color: #115293; }

    .btn-delete {
      background-color: #e53935;
      color: white;
      border: none;
      padding: 8px 12px;
      border-radius: 6px;
      cursor: pointer;
    }
    .btn-delete:hover { background-color: #b71c1c; }

    .section-title {
      margin: 12px 0 15px;
      font-size: 1.1em;
      color: #444;
      text-align: center;
    }

    /* Ø§Ø¬Ø¹Ù„ Ø§Ù„Ø­Ø§ÙˆÙŠØ© ØªØ¹Ø±Ø¶ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª ÙÙŠ ØµÙ Ø£ÙÙ‚ÙŠ */
    #productContainer {
      display: flex;
      gap: 16px;
      flex-wrap: wrap;
      justify-content: center;
      align-items: flex-start;
      padding: 8px 0;
    }

    /* Ø­Ø¬Ù… Ù…ÙˆØ­Ø¯ Ù„ÙƒÙ„ Ø¨Ø·Ø§Ù‚Ø© Ø­ØªÙ‰ ØªØ¨Ø¯Ùˆ Ù…Ø«Ù„ Ø´Ø¨ÙƒØ© Ø£ÙÙ‚ÙŠØ© */
    .product-card {
      width: 240px;
      flex: 0 0 240px;
      margin: 0 8px 16px 8px;
      box-sizing: border-box;
    }

    /* Ø¶Ø¨Ø· Ø§Ù„ØµÙˆØ±Ø© Ø¯Ø§Ø®Ù„ Ø§Ù„Ø¨Ø·Ø§Ù‚Ø© Ù„ØªÙ†Ø§Ø³Ø¨ Ø§Ù„Ø¹Ø±Ø¶ */
    .product-card img {
      width: 100%;
      height: 150px;
      object-fit: cover;
      display: block;
      border-radius: 6px;
    }

    /* ØªÙ†Ù‚Ù„ Ø³Ù„Ø³ Ø¹Ù†Ø¯ Ø§Ù„Ø¶ØºØ· Ø¹Ù„Ù‰ Ø§Ù„Ø¹Ù†ÙˆØ§Ù† */
    html {
      scroll-behavior: smooth;
    }
  </style>
</head>
<body>

  <!-- Ø§Ù„Ø´Ø±ÙŠØ· Ø§Ù„Ø¹Ù„ÙˆÙŠ Ù…Ø¹ ØµÙˆØ±Ø© Ø§Ù„Ù…Ù„Ù Ø§Ù„Ø´Ø®ØµÙŠ ÙˆØ²Ø± Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª -->
  <div class="topbar" role="navigation" aria-label="Top bar">
    <div class="title">Ù„ÙˆØ­Ø© ØªØ­ÙƒÙ… Ø§Ù„Ø¨Ø§Ø¦Ø¹</div>
    <div style="display:flex; align-items:center; gap:8px;">
      <!-- Ø£ÙŠÙ‚ÙˆÙ†Ø© Ø§Ù„Ø±Ø³Ø§Ø¦Ù„ -->
      <div class="icon-btn" id="messagesBtn" title="Ø¹Ø±Ø¶ Ø§Ù„Ø·Ù„Ø¨Ø§Øª" onclick="window.location.href='messages.html'">âœ‰ï¸</div>

      <div class="settings-btn" id="settingsBtn" title="Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ (Ø§Ø¶ØºØ·)">
        âš™ï¸
      </div>

      <div class="profile-area" title="Ø§Ø¶ØºØ· Ù„ØªØºÙŠÙŠØ± ØµÙˆØ±Ø© Ø§Ù„Ø¨Ø±ÙˆÙØ§ÙŠÙ„">
        <!-- ØµÙˆØ±Ø© ØµØºÙŠØ±Ø© Ù‚Ø§Ø¨Ù„Ø© Ù„Ù„Ù†Ù‚Ø± Ù„ØªØºÙŠÙŠØ± Ø§Ù„ØµÙˆØ±Ø© -->
        <img id="topProfilePic" class="top-profile-pic" src="default.jpg" alt="ØµÙˆØ±Ø© Ø§Ù„Ø¨Ø±ÙˆÙØ§ÙŠÙ„">
        <div class="profile-name">Ø§Ù„Ø¨Ø§Ø¦Ø¹</div>
      </div>
    </div>

    <!-- Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ù…Ù†Ø¨Ø«Ù‚Ø© (Ø¹Ù†Ø§ØµØ± Ø§Ù„ØªÙ†Ù‚Ù„ Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø©) -->
    <div class="settings-menu" id="settingsMenu" aria-hidden="true">
      <div class="settings-item" data-target="#addSection">â• Ø¥Ø¶Ø§ÙØ© Ù…Ù†ØªØ¬</div>
      <div class="settings-item" data-target="#productsSection">ğŸ“¦ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª Ø§Ù„Ù…Ø¶Ø§ÙØ©</div>
      <div class="settings-item" id="openLeaderboard">ğŸ† ØªØ±ØªÙŠØ¨ Ø§Ù„Ù…Ø´ØªØ±ÙŠÙŠÙ†</div>
    </div>
  </div>

  <!-- Ù†Ø§ÙØ°Ø© Ø§Ù„Ø·Ù„Ø¨Ø§Øª (modal) -->
  <div class="orders-modal" id="ordersModal" aria-hidden="true">
    <div class="orders-panel" role="dialog" aria-modal="true" aria-labelledby="ordersTitle">
      <h2 id="ordersTitle">ğŸ“¥ Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø·Ù„Ø¨Ø§Øª</h2>
      <div id="ordersContainer" class="orders-list"></div>

      <div style="text-align:left; margin-top:12px;">
        <button class="small-btn btn-delete-order" id="clearOrdersBtn">Ø­Ø°Ù Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø·Ù„Ø¨Ø§Øª</button>
        <button class="small-btn" id="closeOrdersBtn" style="background:#ddd;">Ø¥ØºÙ„Ø§Ù‚</button>
      </div>
    </div>
  </div>

  <!-- Ø§Ù„Ù…Ø­ØªÙˆÙ‰ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ Ù…Ø¹ Ø¥Ø²Ø§Ø­Ø© Ø¨Ø³Ø¨Ø¨ Ø§Ù„Ø´Ø±ÙŠØ· -->
  <div class="page-content">
    <h1 style="margin-top:0;">Ù„ÙˆØ­Ø© ØªØ­ÙƒÙ… Ø§Ù„Ø¨Ø§Ø¦Ø¹</h1>

    <!-- ØµÙ Ø§Ù„Ø¹Ù†Ø§ÙˆÙŠÙ† Ø§Ù„Ø£ÙÙ‚ÙŠ -->
    <div class="titles-row" aria-hidden="false">
      <div class="title-pill" data-target="#addSection">Ø¥Ø¶Ø§ÙØ© Ù…Ù†ØªØ¬</div>
      <div class="title-pill" data-target="#productsSection">Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª Ø§Ù„Ù…Ø¶Ø§ÙØ©</div>
      <!-- ÙØªØ­ leaderboard.html Ù…Ø¨Ø§Ø´Ø±Ø© Ø¹Ù†Ø¯ Ø§Ù„Ø¶ØºØ· -->
      <div class="title-pill" onclick="window.location.href='leaderboard.html'">ØªØ±ØªÙŠØ¨ Ø§Ù„Ù…Ø´ØªØ±ÙŠÙŠÙ†</div>
    </div>

    <section id="addSection">
      <form id="addProductForm" autocomplete="off">
        <h3 class="section-title">Ø¥Ø¶Ø§ÙØ© Ù…Ù†ØªØ¬</h3>
        <input type="text" id="productName" placeholder="Ø§Ø³Ù… Ø§Ù„Ù…Ù†ØªØ¬" required />

        <!-- Ø­Ù‚Ù„ Ù…Ù„Ù Ù„Ø§Ø®ØªÙŠØ§Ø± ØµÙˆØ±Ø© Ù…Ù† Ø§Ù„Ø¬Ù‡Ø§Ø² ÙÙ‚Ø· -->
        <label for="productFile" style="cursor:pointer;">Ø§Ø®ØªØ± ØµÙˆØ±Ø© Ù…Ù† Ø¬Ù‡Ø§Ø²Ùƒ (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)</label>
        <div class="file-row">
          <input type="file" id="productFile" accept="image/*" />
        </div>
        <img id="previewImg" class="img-preview" style="display:none;" alt="Ù…Ø¹Ø§ÙŠÙ†Ø© Ø§Ù„ØµÙˆØ±Ø©">

        <input type="number" id="productPrice" placeholder="Ø§Ù„Ø³Ø¹Ø± Ø¨Ø§Ù„Ø¯Ø¬" required />
        <textarea id="productDesc" placeholder="ÙˆØµÙ Ø§Ù„Ù…Ù†ØªØ¬" required></textarea>
        <button type="submit" id="submitBtn">Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…Ù†ØªØ¬</button>
      </form>
    </section>

    <section id="productsSection" class="product-list">
      <h3 class="section-title">Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª Ø§Ù„Ù…Ø¶Ø§ÙØ©</h3>
      <div id="productContainer"></div>
    </section>

    <!-- Ù‚Ø³Ù… ØªØºÙŠÙŠØ± ØµÙˆØ±Ø© Ø§Ù„Ø¨Ø±ÙˆÙØ§ÙŠÙ„ (ÙˆØ§Ø­Ø¯ ÙÙ‚Ø·ØŒ Ù…Ù†Ø¸Ù…) -->
    <section style="max-width:500px; margin:20px auto; background:#fff; padding:15px; border-radius:10px; text-align:center;">
      <h3 class="section-title">ØªØºÙŠÙŠØ± ØµÙˆØ±Ø© Ø§Ù„Ø¨Ø±ÙˆÙØ§ÙŠÙ„</h3>
      <img id="profilePicPreview" src="" style="display:block; margin:10px auto; max-width:150px; border-radius:50%; object-fit:cover;">
      
      <!-- Ø²Ø± ØªØºÙŠÙŠØ± Ø§Ù„ØµÙˆØ±Ø© -->
      <button id="changeProfileBtn" style="padding:10px 20px; background-color:#1976d2; color:white; border:none; border-radius:6px; cursor:pointer;">
        ØªØºÙŠÙŠØ± Ø§Ù„ØµÙˆØ±Ø© ğŸ“·
      </button>
      
      <!-- Ø­Ù‚Ù„ Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„ØµÙˆØ±Ø© (Ù…Ø®ÙÙŠ) -->
      <input type="file" id="profilePicInput" accept="image/*" style="display:none;">
    </section>
  </div>

  <script>
    // ---- Ø¹Ù†Ø§ØµØ± Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª ----
    const form = document.getElementById('addProductForm');
    const productContainer = document.getElementById('productContainer');
    const submitBtn = document.getElementById('submitBtn');

    const fileInput = document.getElementById('productFile');
    const previewImg = document.getElementById('previewImg');

    let editingIndex = null;
    let selectedImageDataUrl = null; // ØªØ®Ø²ÙŠÙ† Ù…Ø¤Ù‚Øª Ù„ØµÙˆØ±Ø© base64 Ø¥Ù† Ø§Ø®ØªÙŠØ±Øª

    // Ø¯Ø§Ù„Ø© Ù…Ø³Ø§Ø¹Ø¯Ø© Ù„ØªØ¬Ù†Ù‘Ø¨ XSS Ø¹Ù†Ø¯ Ø¥Ø¯Ø±Ø§Ø¬ Ù†Øµ Ù…Ù† Ø§Ù„ØªØ®Ø²ÙŠÙ†
    function escapeHtml(text) {
      if (text === null || text === undefined) return "";
      return String(text)
        .replaceAll("&", "&amp;")
        .replaceAll("<", "&lt;")
        .replaceAll(">", "&gt;")
        .replaceAll('"', "&quot;")
        .replaceAll("'", "&#039;");
    }

    // Ù‚Ø±Ø§Ø¡Ø© Ù…Ù„Ù Ø§Ù„ØµÙˆØ±Ø© ÙˆØ¹Ø±Ø¶ Ø§Ù„Ù…Ø¹Ø§ÙŠÙ†Ø© Ù„Ù„Ù…Ù†ØªØ¬
    fileInput.addEventListener('change', function () {
      const file = this.files[0];
      if (!file) {
        selectedImageDataUrl = null;
        previewImg.style.display = 'none';
        return;
      }
      if (!file.type.startsWith('image/')) {
        alert('Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø§Ø®ØªÙŠØ§Ø± Ù…Ù„Ù ØµÙˆØ±Ø© ØµØ§Ù„Ø­.');
        fileInput.value = '';
        selectedImageDataUrl = null;
        previewImg.style.display = 'none';
        return;
      }
      const reader = new FileReader();
      reader.onload = function (e) {
        selectedImageDataUrl = e.target.result; // data URL
        previewImg.src = selectedImageDataUrl;
        previewImg.style.display = 'block';
      };
      reader.readAsDataURL(file);
    });

    // ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª Ù…Ù† localStorage ÙˆØ¹Ø±Ø¶Ù‡Ø§
    function loadProducts() {
      const products = JSON.parse(localStorage.getItem('products')) || [];
      productContainer.innerHTML = "";
      products.forEach((product, index) => {
        const imgSrc = product.image ? product.image : '';
        productContainer.innerHTML += `
          <div class="product-card" data-index="${index}">
            <h4>${escapeHtml(product.name)}</h4>
            ${imgSrc ? `<img src="${escapeHtml(imgSrc)}" alt="product">` : ''}
            <p>Ø§Ù„Ø³Ø¹Ø±: ${product.price} Ø¯Ø¬</p>
            <p>${escapeHtml(product.desc)}</p>
            <div class="card-actions">
              <button class="btn-edit" data-action="edit" data-index="${index}">ØªØ¹Ø¯ÙŠÙ„</button>
              <button class="btn-delete" data-action="delete" data-index="${index}">Ø­Ø°Ù</button>
            </div>
          </div>
        `;
      });

      // Ø±Ø¨Ø· Ø£Ø²Ø±Ø§Ø± Ø§Ù„ØªØ¹Ø¯ÙŠÙ„ ÙˆØ§Ù„Ø­Ø°Ù Ø¨Ø¹Ø¯ Ø§Ù„Ø¥Ù†Ø´Ø§Ø¡
      document.querySelectorAll('[data-action="edit"]').forEach(btn =>
        btn.addEventListener('click', onEdit)
      );
      document.querySelectorAll('[data-action="delete"]').forEach(btn =>
        btn.addEventListener('click', onDelete)
      );
    }

    // Ø¥Ø¶Ø§ÙØ© Ù…Ù†ØªØ¬ Ø¬Ø¯ÙŠØ¯ Ø£Ùˆ Ø­ÙØ¸ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„
    form.addEventListener('submit', function(e) {
      e.preventDefault();
      const name = document.getElementById('productName').value.trim();
      const price = parseFloat(document.getElementById('productPrice').value);
      const desc = document.getElementById('productDesc').value.trim();

      if (!name || isNaN(price)) {
        alert("ÙŠØ±Ø¬Ù‰ Ù…Ù„Ø¡ Ø§Ù„Ø­Ù‚ÙˆÙ„ Ø¨Ø´ÙƒÙ„ ØµØ­ÙŠØ­.");
        return;
      }

      // Ø³Ù†Ø­ÙØ¸ Ø§Ù„ØµÙˆØ±Ø© Ø¥Ø°Ø§ ØªÙ… Ø§Ø®ØªÙŠØ§Ø±Ù‡Ø§ ÙƒÙ€ data URLØŒ ÙˆØ¥Ù„Ø§ Ù†Ø­ÙØ¸ Ø³Ù„Ø³Ù„Ø© ÙØ§Ø±ØºØ©
      let imageToSave = '';
      if (selectedImageDataUrl) {
        imageToSave = selectedImageDataUrl;
      } else {
        imageToSave = '';
      }

      const newProduct = { name, image: imageToSave, price, desc };

      const products = JSON.parse(localStorage.getItem('products')) || [];

      if (editingIndex === null) {
        products.push(newProduct);
      } else {
        products[editingIndex] = newProduct;
        editingIndex = null;
        submitBtn.textContent = "Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…Ù†ØªØ¬";
      }

      localStorage.setItem('products', JSON.stringify(products));

      // Ø¥Ø¹Ø§Ø¯Ø© ØªÙ‡ÙŠØ¦Ø© Ø§Ù„Ø­Ù‚ÙˆÙ„ ÙˆØ§Ù„Ù…Ø¹Ø§ÙŠÙ†Ø©
      form.reset();
      selectedImageDataUrl = null;
      previewImg.style.display = 'none';
      fileInput.value = '';

      loadProducts();

      // Ø§Ù„ØªÙ…Ø±ÙŠØ± Ø¥Ù„Ù‰ Ù‚Ø³Ù… Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª Ø¨Ø¹Ø¯ Ø§Ù„Ø¥Ø¶Ø§ÙØ©/Ø§Ù„ØªØ¹Ø¯ÙŠÙ„
      const productsSection = document.querySelector('[data-target="#productsSection"]');
      if (productsSection) productsSection.scrollIntoView({behavior: 'smooth'});
    });

    // Ø­Ø¯Ø« Ø§Ù„ØªØ¹Ø¯ÙŠÙ„: ØªØ¹Ø¨Ø¦Ø© Ø§Ù„Ù†Ù…ÙˆØ°Ø¬ Ø¨Ù‚ÙŠÙ… Ø§Ù„Ù…Ù†ØªØ¬ ÙˆØªØ¹ÙŠÙŠÙ† editingIndex
    function onEdit(e) {
      const index = parseInt(e.currentTarget.getAttribute('data-index'));
      const products = JSON.parse(localStorage.getItem('products')) || [];
      const p = products[index];
      if (!p) return alert("Ø§Ù„Ù…Ù†ØªØ¬ ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯.");

      document.getElementById('productName').value = p.name;
      document.getElementById('productPrice').value = p.price;
      document.getElementById('productDesc').value = p.desc;

      // Ø§Ù„ØªØ¹Ø§Ù…Ù„ Ù…Ø¹ Ø§Ù„ØµÙˆØ±Ø©: Ø¥Ù† ÙƒØ§Ù†Øª data URL Ù†Ø¹Ø±Ø¶Ù‡Ø§ ÙÙŠ Ø§Ù„Ù…Ø¹Ø§ÙŠÙ†Ø©ØŒ ÙˆØ¥Ù„Ø§ Ù†ØªØ±Ùƒ Ø§Ù„Ù…Ø¹Ø§ÙŠÙ†Ø© ÙØ§Ø±ØºØ©
      if (p.image && p.image.startsWith('data:')) {
        selectedImageDataUrl = p.image;
        previewImg.src = selectedImageDataUrl;
        previewImg.style.display = 'block';
        fileInput.value = '';
      } else {
        selectedImageDataUrl = null;
        previewImg.style.display = 'none';
        fileInput.value = '';
      }

      editingIndex = index;
      submitBtn.textContent = "Ø­ÙØ¸ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„";
      // Ø§Ù„ØªÙ…Ø±ÙŠØ± Ø¥Ù„Ù‰ Ø§Ù„Ù†Ù…ÙˆØ°Ø¬ Ù„ØªØ³Ù‡ÙŠÙ„ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„
      document.getElementById('productName').scrollIntoView({behavior: 'smooth'});
    }

    // Ø­Ø¯Ø« Ø§Ù„Ø­Ø°Ù: Ø¥Ø²Ø§Ù„Ø© Ø§Ù„Ù…Ù†ØªØ¬ Ù…Ù† Ø§Ù„ØªØ®Ø²ÙŠÙ†
    function onDelete(e) {
      const index = parseInt(e.currentTarget.getAttribute('data-index'));
      if (!confirm("Ù‡Ù„ ØªØ±ÙŠØ¯ Ø­Ø°Ù Ù‡Ø°Ø§ Ø§Ù„Ù…Ù†ØªØ¬ØŸ")) return;
      const products = JSON.parse(localStorage.getItem('products')) || [];
      products.splice(index, 1);
      localStorage.setItem('products', JSON.stringify(products));
      loadProducts();
    }

    // Ø±Ø¨Ø· Ø³Ù„ÙˆÙƒ Ø§Ù„Ø¹Ù†Ø§ÙˆÙŠÙ† Ø§Ù„Ø£ÙÙ‚ÙŠØ© (Ø§Ù„ØªÙ…Ø±ÙŠØ±)
    document.querySelectorAll('.title-pill').forEach(pill => {
      pill.addEventListener('click', () => {
        const target = pill.getAttribute('data-target');
        const el = document.querySelector(target);
        if (el) el.scrollIntoView({behavior: 'smooth'});
      });
    });

    // ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª Ø¹Ù†Ø¯ ÙØªØ­ Ø§Ù„ØµÙØ­Ø©
    loadProducts();

    // ---- Ø¹Ù†Ø§ØµØ± ØªØºÙŠÙŠØ± ØµÙˆØ±Ø© Ø§Ù„Ø¨Ø±ÙˆÙØ§ÙŠÙ„ ----
    const profilePicInput = document.getElementById('profilePicInput');
    const profilePicPreview = document.getElementById('profilePicPreview');
    const changeProfileBtn = document.getElementById('changeProfileBtn');
    const topProfilePic = document.getElementById('topProfilePic');

    // Ø¹Ø±Ø¶ Ø§Ù„ØµÙˆØ±Ø© Ø§Ù„Ù…Ø­ÙÙˆØ¸Ø© Ø¹Ù†Ø¯ ÙØªØ­ Ø§Ù„ØµÙØ­Ø©
    function loadProfilePic() {
      const savedPic = localStorage.getItem('storeProfilePic');
      if (savedPic) {
        profilePicPreview.src = savedPic;
        profilePicPreview.style.display = 'block';
        topProfilePic.src = savedPic;
      } else {
        // ØµÙˆØ±Ø© Ø§ÙØªØ±Ø§Ø¶ÙŠØ© (ÙŠÙ…ÙƒÙ† ØªØºÙŠÙŠØ±Ù‡)
        profilePicPreview.src = 'default.jpg';
        topProfilePic.src = 'default.jpg';
      }
    }

    window.addEventListener('load', loadProfilePic);

    // Ø¹Ù†Ø¯ Ø§Ù„Ø¶ØºØ· Ø¹Ù„Ù‰ Ø§Ù„Ø²Ø± Ù†ÙØªØ­ Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ù…Ù„Ù
    changeProfileBtn.addEventListener('click', () => {
      profilePicInput.click();
    });

    // Ø¹Ù†Ø¯ Ø§Ù„Ø¶ØºØ· Ø¹Ù„Ù‰ Ø§Ù„ØµÙˆØ±Ø© Ø§Ù„Ø¹Ù„ÙˆÙŠØ© Ø£ÙŠØ¶Ø§Ù‹ Ù†ÙØªØ­ Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ù…Ù„Ù
    topProfilePic.addEventListener('click', () => {
      profilePicInput.click();
    });

    // Ø¹Ù†Ø¯ Ø§Ø®ØªÙŠØ§Ø± ØµÙˆØ±Ø© Ø¬Ø¯ÙŠØ¯Ø©
    profilePicInput.addEventListener('change', function () {
      const file = this.files[0];
      if (!file) return;
      if (!file.type.startsWith('image/')) {
        alert("Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø§Ø®ØªÙŠØ§Ø± ØµÙˆØ±Ø© ØµØ­ÙŠØ­Ø©.");
        return;
      }
      const reader = new FileReader();
      reader.onload = function (e) {
        const imgData = e.target.result;
        profilePicPreview.src = imgData;
        profilePicPreview.style.display = 'block';
        topProfilePic.src = imgData;
        localStorage.setItem('storeProfilePic', imgData);
        alert("âœ… ØªÙ… ØªØºÙŠÙŠØ± ØµÙˆØ±Ø© Ø§Ù„Ø¨Ø±ÙˆÙØ§ÙŠÙ„ Ø¨Ù†Ø¬Ø§Ø­");
      };
      reader.readAsDataURL(file);
    });

    // ---- Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© (Ø²Ø± Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ù…Ù†Ø¨Ø«Ù‚) ----
    const settingsBtn = document.getElementById('settingsBtn');
    const settingsMenu = document.getElementById('settingsMenu');
    const settingsItems = settingsMenu.querySelectorAll('.settings-item');
    const openLeaderboard = document.getElementById('openLeaderboard');

    // ØªØ¨Ø¯ÙŠÙ„ Ø¹Ø±Ø¶ Ø§Ù„Ù‚Ø§Ø¦Ù…Ø©
    settingsBtn.addEventListener('click', (e) => {
      e.stopPropagation();
      settingsMenu.classList.toggle('show');
      settingsMenu.setAttribute('aria-hidden', settingsMenu.classList.contains('show') ? 'false' : 'true');
    });

    // Ø¥ØºÙ„Ø§Ù‚ Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø¹Ù†Ø¯ Ø§Ù„Ù†Ù‚Ø± ÙÙŠ Ø£ÙŠ Ù…ÙƒØ§Ù† Ø®Ø§Ø±Ø¬Ù‡Ø§
    document.addEventListener('click', (ev) => {
      if (!settingsMenu.contains(ev.target) && ev.target !== settingsBtn) {
        settingsMenu.classList.remove('show');
        settingsMenu.setAttribute('aria-hidden', 'true');
      }
    });

    // Ø±Ø¨Ø· Ø¹Ù†Ø§ØµØ± Ø§Ù„Ù‚Ø§Ø¦Ù…Ø©: ØªÙ…Ø±ÙŠØ± Ø¥Ù„Ù‰ Ø§Ù„Ø£Ù‚Ø³Ø§Ù… Ø£Ùˆ ÙØªØ­ leaderboard
    settingsItems.forEach(item => {
      item.addEventListener('click', () => {
        const target = item.getAttribute('data-target');
        if (target) {
          const el = document.querySelector(target);
          if (el) {
            el.scrollIntoView({ behavior: 'smooth' });
          }
        }
        settingsMenu.classList.remove('show');
        settingsMenu.setAttribute('aria-hidden', 'true');
      });
    });

    openLeaderboard.addEventListener('click', () => {
      // ÙØªØ­ leaderboard.html ÙƒÙ…Ø§ ÙÙŠ Ø§Ù„Ø²Ø± Ø§Ù„Ø£ØµÙ„ÙŠ
      window.location.href = 'leaderboard.html';
    });

    // ---- Ø§Ù„Ø±Ø³Ø§Ø¦Ù„ / Ø¹Ø±Ø¶ Ø§Ù„Ø·Ù„Ø¨Ø§Øª ----
    const messagesBtn = document.getElementById('messagesBtn');
    const ordersModal = document.getElementById('ordersModal');
    const ordersContainer = document.getElementById('ordersContainer');
    const closeOrdersBtn = document.getElementById('closeOrdersBtn');
    const clearOrdersBtn = document.getElementById('clearOrdersBtn');

    // ØªØ¹Ø¯ÙŠÙ„: Ø¹Ù†Ø¯ Ø§Ù„Ø¶ØºØ· Ø¹Ù„Ù‰ Ø£ÙŠÙ‚ÙˆÙ†Ø© Ø§Ù„Ø±Ø³Ø§Ø¦Ù„ØŒ ÙŠØªÙ… ÙØªØ­ ØµÙØ­Ø© messages.html Ù…Ø¨Ø§Ø´Ø±Ø©
   
  document.getElementById("messagesBtn").addEventListener("click", () => {
    window.location.href = "messages.html";
  });


    // Ø¯Ø§Ù„Ø© Ù„ØªÙ‡ÙŠØ¦Ø© Ø¹Ø±Ø¶ Ø§Ù„Ø·Ù„Ø¨Ø§Øª (ØªÙ… Ø§Ù„Ø§Ø­ØªÙØ§Ø¸ Ø¨Ù‡Ø§ Ù„Ù„ØªÙˆØ§ÙÙ‚ Ù…Ø¹ Ø§Ù„Ø£ÙƒÙˆØ§Ø¯ Ø§Ù„Ø£Ø®Ø±Ù‰)
    function renderOrders() {
      ordersContainer.innerHTML = '';
      // Ù†Ø¨Ø­Ø« Ø£ÙˆÙ„Ù‹Ø§ Ø¹Ù† Ù…ØµÙÙˆÙØ© 'orders' ÙÙŠ localStorage
      const orders = JSON.parse(localStorage.getItem('orders')) || null;

      if (orders && Array.isArray(orders) && orders.length > 0) {
        // Ø¹Ø±Ø¶ ÙƒÙ„ Ø·Ù„Ø¨
        orders.slice().reverse().forEach(order => { // Ø¹Ø±Ø¶ Ø£Ø­Ø¯Ø« Ø£ÙˆÙ„Ø§Ù‹
          const card = document.createElement('div');
          card.className = 'order-card';
          const dt = order.date ? new Date(order.date).toLocaleString('ar-EG') : '';
          const itemsHtml = (order.items || []).map(it =>
            `<div class="order-item"><div>${escapeHtml(it.name)}</div><div>${it.price} Ø¯Ø¬</div></div>`
          ).join('');
          card.innerHTML = `
            <div class="order-meta">
              <strong>${escapeHtml(order.name || 'â€”')}</strong>
              <span>â€¢</span>
              <span>Ø§Ù„Ù‡Ø§ØªÙ: <a href="tel:${encodeURIComponent(order.phone || '')}">${escapeHtml(order.phone || 'â€”')}</a></span>
              <span>â€¢</span>
              <span>Ø§Ù„ØªØ§Ø±ÙŠØ®: ${escapeHtml(dt)}</span>
            </div>
            <div style="margin-top:8px;"><strong>Ø§Ù„Ø¹Ù†ÙˆØ§Ù†:</strong> ${escapeHtml(order.address || 'â€”')}</div>
            <div style="margin-top:6px;"><strong>Ø§Ù„Ø¨Ø±ÙŠØ¯:</strong> ${escapeHtml(order.email || 'â€”')}</div>
            <div class="order-items">
              ${itemsHtml || '<div style="color:#777;padding:6px 0">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¹Ù†Ø§ØµØ± Ù…ÙØµÙ‘Ù„Ø©</div>'}
            </div>
            <div style="margin-top:8px; display:flex; justify-content:space-between; align-items:center;">
              <div><strong>Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹:</strong> ${escapeHtml(String(order.total || 0))} Ø¯Ø¬</div>
              <div><strong>Ø§Ù„Ù†Ù‚Ø§Ø·:</strong> ${escapeHtml(String(order.points || 0))}</div>
            </div>
            <div class="order-actions">
              <button class="small-btn btn-email" onclick="location.href='mailto:${encodeURIComponent(order.email || '')}?subject=${encodeURIComponent('Ø§Ø³ØªÙØ³Ø§Ø± Ø­ÙˆÙ„ Ø·Ù„Ø¨Ùƒ')}';">Ø¨Ø±ÙŠØ¯</button>
              <button class="small-btn btn-call" onclick="location.href='tel:${encodeURIComponent(order.phone || '')}';">Ø§ØªØµØ§Ù„</button>
              <button class="small-btn btn-delete-order" onclick="deleteOrder('${order.id}');">Ø­Ø°Ù</button>
            </div>
          `;
          ordersContainer.appendChild(card);
        });
      } else {
        // Ø¥Ù† Ù„Ù… ØªÙˆØ¬Ø¯ Ù…ØµÙÙˆÙØ© ordersØŒ Ù†Ø­Ø§ÙˆÙ„ Ø§Ø³ØªØ®Ø¯Ø§Ù… user_data Ù…Ø¹ user_points Ù„Ù„Ø´Ù‡Ø± Ø§Ù„Ø­Ø§Ù„ÙŠ ÙƒÙ†Ø³Ø®Ø© Ø§Ø­ØªÙŠØ§Ø·
        const now = new Date();
        const year = now.getFullYear();
        const month = String(now.getMonth() + 1).padStart(2, '0');
        const pointsKey = `user_points_${year}_${month}`;
        const allPoints = JSON.parse(localStorage.getItem(pointsKey)) || {};
        const allUsersData = JSON.parse(localStorage.getItem('user_data')) || {};

        const users = Object.keys(allUsersData || {});
        if (users.length === 0) {
          ordersContainer.innerHTML = `<div class="no-orders">ğŸ“­ Ù„Ø§ ØªÙˆØ¬Ø¯ Ø·Ù„Ø¨Ø§Øª Ù…Ø­ÙÙˆØ¸Ø© Ø­Ø§Ù„ÙŠØ§Ù‹.</div>`;
        } else {
          users.forEach(name => {
            const info = allUsersData[name] || {};
            const pts = allPoints[name] || 0;
            const card = document.createElement('div');
            card.className = 'order-card';
            card.innerHTML = `
              <div class="order-meta"><strong>${escapeHtml(info.name || name)}</strong> <span>â€¢</span> <span>Ø§Ù„Ù‡Ø§ØªÙ: <a href="tel:${encodeURIComponent(info.phone || '')}">${escapeHtml(info.phone || 'â€”')}</a></span></div>
              <div style="margin-top:8px;"><strong>Ø§Ù„Ø¹Ù†ÙˆØ§Ù†:</strong> ${escapeHtml(info.address || 'â€”')}</div>
              <div style="margin-top:6px;"><strong>Ø§Ù„Ø¨Ø±ÙŠØ¯:</strong> ${escapeHtml(info.email || 'â€”')}</div>
              <div style="margin-top:8px;"><strong>Ù†Ù‚Ø§Ø· Ù‡Ø°Ø§ Ø§Ù„Ø´Ù‡Ø±:</strong> ${escapeHtml(String(pts))}</div>
              <div class="order-actions">
                <button class="small-btn btn-email" onclick="location.href='mailto:${encodeURIComponent(info.email || '')}?subject=${encodeURIComponent('Ø§Ø³ØªÙØ³Ø§Ø± Ø­ÙˆÙ„ Ø­Ø³Ø§Ø¨Ùƒ')}';">Ø¨Ø±ÙŠØ¯</button>
                <button class="small-btn btn-call" onclick="location.href='tel:${encodeURIComponent(info.phone || '')}';">Ø§ØªØµØ§Ù„</button>
              </div>
            `;
            ordersContainer.appendChild(card);
          });
        }
      }
    }

    // Ø­Ø°Ù Ø·Ù„Ø¨ Ø¨Ø¹ÙŠÙ†Ù‡ (Ø¨Ø§Ø³ØªØ®Ø¯Ø§Ù… id)
    function deleteOrder(id) {
      if (!confirm('Ù‡Ù„ ØªØ±ÙŠØ¯ Ø­Ø°Ù Ù‡Ø°Ø§ Ø§Ù„Ø·Ù„Ø¨ØŸ')) return;
      const orders = JSON.parse(localStorage.getItem('orders')) || [];
      const updated = orders.filter(o => o.id !== id);
      localStorage.setItem('orders', JSON.stringify(updated));
      renderOrders();
    }

    // Ù…Ø³Ø­ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø·Ù„Ø¨Ø§Øª
    clearOrdersBtn.addEventListener('click', () => {
      if (!confirm('ØªØ­Ø°ÙŠØ±: Ø³ÙŠØªÙ… Ø­Ø°Ù Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø·Ù„Ø¨Ø§Øª. Ù‡Ù„ ØªØ±ÙŠØ¯ Ø§Ù„Ø§Ø³ØªÙ…Ø±Ø§Ø±ØŸ')) return;
      localStorage.removeItem('orders');
      renderOrders();
    });

    // Ø¥ØºÙ„Ø§Ù‚ Ø¹Ù†Ø¯ Ø§Ù„Ù†Ù‚Ø± Ø®Ø§Ø±Ø¬ Ø§Ù„Ù„ÙˆØ­Ø©
    ordersModal.addEventListener('click', (ev) => {
      if (ev.target === ordersModal) {
        ordersModal.classList.remove('show');
        ordersModal.setAttribute('aria-hidden', 'true');
      }
    });

    // --- Ù†Ù‡Ø§ÙŠØ© Ù†Ø¸Ø§Ù… Ø§Ù„Ø±Ø³Ø§Ø¦Ù„/Ø§Ù„Ø·Ù„Ø¨Ø§Øª ---
    // Ø²Ø± Ø­Ø°Ù ÙƒÙ„ Ø§Ù„Ø·Ù„Ø¨Ø§Øª
    document.getElementById('deleteAllOrdersBtn').addEventListener('click', () => {
      if (confirm("Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø·Ù„Ø¨Ø§ØªØŸ")) {
        localStorage.removeItem('orders'); // Ø­Ø°Ù Ø§Ù„Ø·Ù„Ø¨Ø§Øª Ù…Ù† Ø§Ù„ØªØ®Ø²ÙŠÙ†
        displayOrders(); // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¹Ø±Ø¶
      }
    });
  </script>

</body>
</html>